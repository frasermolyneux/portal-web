# Copilot Instructions

- **Purpose & stack**: ASP.NET Core 9 web app in [src/XtremeIdiots.Portal.Web/XtremeIdiots.Portal.Web.csproj](src/XtremeIdiots.Portal.Web/XtremeIdiots.Portal.Web.csproj). Uses Razor runtime compilation in Debug, build-time in Release, Application Insights, Azure App Configuration, Entity Framework Core identity store, and Data Protection in SQL. External clients target the Repository API, Servers Integration API, and GeoLocation API.
- **Build/test loop**: Standard sequence: `dotnet clean src/XtremeIdiots.Portal.Web/XtremeIdiots.Portal.Web.csproj`; `dotnet build src/XtremeIdiots.Portal.Web/XtremeIdiots.Portal.Web.csproj`; `dotnet test src --filter "FullyQualifiedName!~IntegrationTests"`. Release builds treat warnings as errors and precompile Razor.
- **Front-end assets**: SCSS lives under `Styles/` with the structure documented in [docs/css-architecture-guide.md](docs/css-architecture-guide.md). `npm install` runs automatically on first build; SCSS compiles during `dotnet build` via `npm run build:css:dev` (Debug) or `npm run build:css` (Release). For live editing run `npm run watch:css` from `src/XtremeIdiots.Portal.Web`.
- **Docs to consult**: CI/CD and branch rules in [docs/development-workflows.md](docs/development-workflows.md); data table patterns in [docs/DATATABLE-IMPLEMENTATION-GUIDE.md](docs/DATATABLE-IMPLEMENTATION-GUIDE.md); permissions nuances in [docs/credentials-permissions-matrix.md](docs/credentials-permissions-matrix.md); manual deployment/config steps in [docs/manual-steps.md](docs/manual-steps.md).
- **Workflows & labels**: GitHub Actions pipelines are in `.github/workflows` (build-and-test, pr-verify, deploy-dev, deploy-prd, codequality, copilot-setup-steps, dependabot-automerge). PRs run dev Terraform plans; prod plans require the `run-prd-plan` label; copilot/* and dependabot PRs skip plans unless labeled.
- **App configuration**: Sensitive settings are expected via user secrets (see `UserSecretsId` in the csproj) or environment variables. Azure App Configuration and managed identity are supported; Application Insights connection strings should be present for telemetry.
- **Common troubleshooting**: If SCSS fails to compile, run `npm install` then `npm run build:css:dev`. If Razor view issues arise, enable `ValidateRazor=true` on build to precompile views. Identity/claims issues often map back to the matrices in [docs/credentials-permissions-matrix.md](docs/credentials-permissions-matrix.md).
- **Testing scope**: Integration tests are filtered out by default; keep new tests in `src/XtremeIdiots.Portal.Web.Tests` and respect the existing filter unless infrastructure is available.
